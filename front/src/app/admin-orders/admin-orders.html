<div class="container-fluid bg-dark text-white min-vh-100 p-3 p-md-5">
  
  <div class="d-flex justify-content-between align-items-center mb-5">
    <h2 class="text-warning fw-bold mb-0">Gestion des Commandes</h2>
    <a routerLink="/stocks" class="btn btn-outline-light">
      <i class="bi bi-arrow-left me-2"></i>Retour
    </a>
  </div>

  <div class="mb-5">
    <h4 class="text-white mb-3 d-flex align-items-center">
      <span class="badge bg-warning text-dark me-2">{{ commandesEnAttente.length }}</span>
      ‚è≥ En attente de validation
    </h4>
    
    <div class="card bg-secondary border-warning shadow-lg" style="--bs-bg-opacity: 0.1">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-dark table-hover mb-0 align-middle">
            <thead class="text-warning text-uppercase small">
              <tr>
                <th class="ps-4">#ID</th>
                <th>Date</th>
                <th>Client</th>
                <th>Montant</th>
                <th class="text-end pe-4">Action Requise</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let c of commandesEnAttente">
                <td class="ps-4 text-white">#{{ c.id_commande }}</td>
                <td>{{ c.date_creation | date:'dd/MM HH:mm' }}</td>
                <td>
                  <div class="fw-bold">{{ c.username }}</div>
                  <div class="small text-white">{{ c.email }}</div>
                </td>
                <td class="fw-bold text-warning">{{ c.total_ttc | number:'1.2-2' }} ‚Ç¨</td>
                <td class="text-end pe-4">
                  <button class="btn btn-sm btn-primary fw-bold me-2" (click)="passerEtapeSuivante(c)">
                    <i class="bi bi-check-lg me-1"></i> Valider
                  </button>
                  <button class="btn btn-sm btn-outline-danger" (click)="demanderAnnulation(c.id_commande)">
                    <i class="bi bi-x-lg"></i>
                  </button>
                </td>
              </tr>
              <tr *ngIf="commandesEnAttente.length === 0">
                <td colspan="5" class="text-center py-4 text-white fst-italic">Aucune commande en attente.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="mb-5">
    <h4 class="text-white mb-3 d-flex align-items-center">
      <span class="badge bg-primary me-2">{{ commandesValidees.length }}</span>
      üí∏ En attente de paiement (Valid√©es)
    </h4>

    <div class="card bg-secondary border-primary shadow-lg" style="--bs-bg-opacity: 0.1">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-dark table-hover mb-0 align-middle">
            <thead class="text-primary text-uppercase small">
              <tr>
                <th class="ps-4">#ID</th>
                <th>Date</th>
                <th>Client</th>
                <th>Montant</th>
                <th class="text-end pe-4">Action Requise</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let c of commandesValidees">
                <td class="ps-4 text-white">#{{ c.id_commande }}</td>
                <td>{{ c.date_creation | date:'dd/MM HH:mm' }}</td>
                <td>
                  <div class="fw-bold">{{ c.username }}</div>
                  <div class="small text-white">{{ c.email }}</div>
                </td>
                <td class="fw-bold text-white">{{ c.total_ttc | number:'1.2-2' }} ‚Ç¨</td>
                <td class="text-end pe-4">
                  <button class="btn btn-sm btn-success fw-bold me-2" (click)="passerEtapeSuivante(c)">
                    <i class="bi bi-cash-coin me-1"></i> Encaisser
                  </button>
                  <button class="btn btn-sm btn-outline-danger" (click)="demanderAnnulation(c.id_commande)">
                    <i class="bi bi-x-lg"></i>
                  </button>
                </td>
              </tr>
              <tr *ngIf="commandesValidees.length === 0">
                <td colspan="5" class="text-center py-4 text-white fst-italic">Aucune commande en attente de paiement.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="mb-5">
    <h4 class="text-white-50 mb-3">‚úÖ Historique (Termin√©es)</h4>
    
    <div class="card bg-dark border-secondary shadow">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-dark table-striped mb-0 align-middle">
            <thead class="text-white text-uppercase small">
              <tr>
                <th class="ps-4">#ID</th>
                <th>Date</th>
                <th>Client</th>
                <th>Montant</th>
                <th>Statut Final</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let c of commandesTerminees">
                <td class="ps-4 text-white">#{{ c.id_commande }}</td>
                <td class="text-white">{{ c.date_creation | date:'dd/MM/yyyy' }}</td>
                <td>
                  <div class="text-white-50">{{ c.username }}</div>
                </td>
                <td class="text-white-50">{{ c.total_ttc | number:'1.2-2' }} ‚Ç¨</td>
                <td>
                  <span class="badge" [ngClass]="'bg-' + getStatusColor(c.statut)">
                    {{ c.statut }}
                  </span>
                </td>
              </tr>
              <tr *ngIf="commandesTerminees.length === 0">
                <td colspan="5" class="text-center py-4 text-white">Historique vide.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</div>

<app-confirm-modal
  [isOpen]="isModalOpen"
  title="Annuler la commande ?"
  message="√ätes-vous s√ªr de vouloir annuler cette commande ?"
  actionLabel="Oui, annuler"
  colorType="danger"
  (confirm)="confirmerAnnulation()"
  (cancel)="isModalOpen = false"
></app-confirm-modal>